[{"type":"tab","id":"86aad6db.795528","label":"Skelbot"},{"id":"3ab1830c.c54e7c","type":"mqtt-broker","broker":"localhost","port":"1883","clientid":""},{"id":"73b2cb76.8c4d34","type":"http in","name":"GUI","url":"/gui","method":"get","x":146,"y":51,"z":"86aad6db.795528","wires":[["59fe4c99.a601b4"]]},{"id":"59fe4c99.a601b4","type":"template","name":"GuiHTML","field":"","template":"<html>\n\t<head>\n\t\t<script>\n\t\t\tfunction sendAction(action) {\n\t\t\t\tvar xmlhttp=new XMLHttpRequest();\n\t\t\t\txmlhttp.open(\"GET\",\"/controller?action=\" + action,true);\n\t\t\t\txmlhttp.send();\n\t\t\t\n\t\t\t}\t\n\t\t</script>\n\t</head>\n\t\n\t<body>\n\t\t<h1>Skelbot</h1>\n\t\t<p>\n\t\t\t<button onclick=\"sendAction('Laugh')\">Le</button> \n\t\t\t<button onclick=\"sendAction('Scare')\">Skrem</button> \n\t\t\t<button onclick=\"sendAction('Greet')\">Hils</button> \n\t\t\t<button onclick=\"sendAction('Sleep')\">Sov</button> \n\t\t</p>\t\n\t</body>\n</html>\n","x":365,"y":62,"z":"86aad6db.795528","wires":[["ab80ed87.547f1"]]},{"id":"ab80ed87.547f1","type":"http response","name":"GuiHTTPResponse","x":613,"y":52,"z":"86aad6db.795528","wires":[]},{"id":"94978794.6b6878","type":"http in","name":"Controller","url":"/controller","method":"get","x":137,"y":169,"z":"86aad6db.795528","wires":[["5e0861b1.a1f7a","c2ee1d4f.3d11e"]]},{"id":"5e0861b1.a1f7a","type":"switch","name":"BehaviourSwitch","property":"req.query.action","rules":[{"t":"eq","v":"Laugh"},{"t":"eq","v":"Scare"},{"t":"eq","v":"Greet"},{"t":"eq","v":"Sleep"}],"checkall":"true","outputs":4,"x":364,"y":354,"z":"86aad6db.795528","wires":[["d94bfcf5.26b4"],["24707601.db8f8a"],["feb24458.014db8"],["e99acaa9.166538"]]},{"id":"c2ee1d4f.3d11e","type":"http response","name":"","x":360,"y":181,"z":"86aad6db.795528","wires":[]},{"id":"41ed168e.be12e8","type":"file","name":"FileWriter","filename":"/home/pi/skelbot/outputfile.txt","appendNewline":true,"overwriteFile":false,"x":584.0001525878906,"y":728,"z":"86aad6db.795528","wires":[]},{"id":"e9948713.166b78","type":"exec","command":"omxplayer","append":"msg.payload","useSpawn":true,"name":"PlaySound","x":597.0001831054688,"y":559,"z":"86aad6db.795528","wires":[[],[],[]]},{"id":"985d8899.67a278","type":"function","name":"PerformActions","func":"var XMLHttpRequest = context.global.xmlhttprequest.XMLHttpRequest;\n\n//Creates a callout to HTTPIn node\nfunction httpCallout(page, servo, value) {\n\tvar xmlhttp = new XMLHttpRequest();\n\txmlhttp.open(\"GET\",\"http://localhost:1880/\" + page + \"?servo=\" + servo + \"&value=\" + value,true);\n\txmlhttp.send();\n}\n\n//Delays a number of milliseconds before next action\nfunction delay(milliseconds) {\n  var start = new Date().getTime();\n  for (var i = 0; i < 1e7; i++) {\n    if ((new Date().getTime() - start) > milliseconds){\n      break;\n    }\n  }\n}\n\n//Iterate over actionlist to perform all actions\nfor(index = 0; index < msg.actionList.length; index++) {\n\tvar actionItem = msg.actionList[index];\n\n\tswitch(actionItem.action) {\n\t\tcase \"PLAY_SOUND\":\n\t\t\thttpCallout(\"playsound\", \"\", actionItem.value);\n\t\t\tbreak;\n\t\tcase \"TURN_HEAD\":\n\t\t\thttpCallout(\"moveservo\", \"1\", actionItem.value);\n\t\t\tbreak;\n\t\tcase \"TILT_HEAD\":\n\t\t\thttpCallout(\"moveservo\", \"2\", actionItem.value);\n\t\t\tbreak;\n\t\tcase \"MOVE_RIGHT_ARM\":\n\t\t\thttpCallout(\"moveservo\", \"3\", actionItem.value);\n\t\t\tbreak;\n\t\tcase \"DELAY\":\n\t\t\thttpCallout(\"delay\", \"\",  actionItem.value);\n\t}\n}\n\nreturn msg;","outputs":1,"x":841,"y":362,"z":"86aad6db.795528","wires":[[]]},{"id":"d94bfcf5.26b4","type":"function","name":"BuildLaugh","func":"msg.actionList = [\n    {\"action\":\"TURN_HEAD\", \"value\":\"200\"}, \n\t{\"action\":\"PLAY_SOUND\", \"value\":\"test.mp3\"},\n    {\"action\":\"TILT_HEAD\", \"value\": \"100\"}\n];\n\nreturn msg;","outputs":1,"x":596.0000305175781,"y":268,"z":"86aad6db.795528","wires":[["985d8899.67a278"]]},{"id":"53b7adb6.ac4854","type":"http in","name":"PlaySound","url":"/playsound","method":"get","x":142,"y":556.0001220703125,"z":"86aad6db.795528","wires":[["c12453ad.3edbb","5d5dbc19.a2a244"]]},{"id":"b5ed2e57.4a12d","type":"debug","name":"","active":true,"console":"false","complete":"true","x":588.0001831054688,"y":607.0003662109375,"z":"86aad6db.795528","wires":[]},{"id":"c12453ad.3edbb","type":"function","name":"PlaySound","func":"msg.payload = \"/home/pi/skelbot/mp3/\" + msg.req.query.value;\nvar debug = \"Playing sound \" + msg.req.query.value;\nreturn [msg, debug];","outputs":"2","x":372,"y":605.0003967285156,"z":"86aad6db.795528","wires":[["e9948713.166b78"],["b5ed2e57.4a12d"]]},{"id":"5d5dbc19.a2a244","type":"http response","name":"","x":360,"y":555.0001831054688,"z":"86aad6db.795528","wires":[]},{"id":"4956f013.b6a91","type":"http in","name":"MoveServo","url":"/moveservo","method":"get","x":144.88888549804688,"y":686.2222290039062,"z":"86aad6db.795528","wires":[["a8ba8366.57458","98eccc43.67133"]]},{"id":"a8ba8366.57458","type":"function","name":"MoveServo","func":"msg.payload = msg.req.query.servo + \"=\" + msg.req.query.value + \"\\n\";\nvar debug = \"Moving servo nr\" + msg.req.query.servo + \" to position \" + msg.req.query.value;\n\nreturn [msg, debug];","outputs":"2","x":374.8888854980469,"y":735.2225036621094,"z":"86aad6db.795528","wires":[["41ed168e.be12e8"],["9477c19a.6b884"]]},{"id":"98eccc43.67133","type":"http response","name":"","x":362.8888854980469,"y":685.2222900390625,"z":"86aad6db.795528","wires":[]},{"id":"9477c19a.6b884","type":"debug","name":"","active":true,"console":"false","complete":"true","x":576.8889770507812,"y":774.888916015625,"z":"86aad6db.795528","wires":[]},{"id":"24707601.db8f8a","type":"function","name":"BuildScare","func":"msg.actionList = [\n    {\"action\":\"TURN_HEAD\", \"value\":\"100\"}, \n    {\"action\":\"MOVE_RIGHT_ARM\", \"value\":\"100\"}, \n\t{\"action\":\"PLAY_SOUND\", \"value\":\"test.mp3\"},\n\t{\"action\":\"DELAY\", \"value\":\"5000\"},\n\t{\"action\":\"PLAY_SOUND\", \"value\":\"test.mp3\"},\n    {\"action\":\"TILT_HEAD\", \"value\": \"100\"}\n];\n\nreturn msg;","outputs":1,"x":595,"y":332,"z":"86aad6db.795528","wires":[["985d8899.67a278"]]},{"id":"feb24458.014db8","type":"function","name":"BuildGreet","func":"msg.actionList = [\n    {\"action\":\"TURN_HEAD\", \"value\":\"200\"}, \n\t{\"action\":\"PLAY_SOUND\", \"value\":\"test.mp3\"},\n    {\"action\":\"TILT_HEAD\", \"value\": \"100\"}\n];\n\nreturn msg;","outputs":1,"x":596,"y":390,"z":"86aad6db.795528","wires":[["985d8899.67a278"]]},{"id":"e99acaa9.166538","type":"function","name":"BuildSleep","func":"msg.actionList = [\n    {\"action\":\"TURN_HEAD\", \"value\":\"200\"}, \n\t{\"action\":\"PLAY_SOUND\", \"value\":\"test.mp3\"},\n    {\"action\":\"TILT_HEAD\", \"value\": \"100\"}\n];\n\nreturn msg;","outputs":1,"x":597,"y":458,"z":"86aad6db.795528","wires":[["985d8899.67a278"]]},{"id":"af5f8a60.50a078","type":"http in","name":"Delay","url":"/delay","method":"get","x":143,"y":855.2222290039062,"z":"86aad6db.795528","wires":[["efc9f1d0.10361"]]},{"id":"efc9f1d0.10361","type":"function","name":"Delay","func":"  var start = new Date().getTime();\n  for (var i = 0; i < 1e7; i++) {\n    if ((new Date().getTime() - start) > msg.req.query.value){\n      break;\n    }\n  }\n\nvar debug = \"Delaying for \" + msg.req.query.value;\n\nreturn [msg, debug];","outputs":"2","x":362,"y":863.2224731445312,"z":"86aad6db.795528","wires":[["cb0e7c5e.34f18"],["15296af6.ead695"]]},{"id":"cb0e7c5e.34f18","type":"http response","name":"","x":577,"y":858.2222900390625,"z":"86aad6db.795528","wires":[]},{"id":"15296af6.ead695","type":"debug","name":"","active":true,"console":"false","complete":"true","x":576.0001220703125,"y":913.888916015625,"z":"86aad6db.795528","wires":[]}]